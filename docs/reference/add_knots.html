<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Add Quasi-optimal Knots for the Piecewise Constant Basis — add_knots • DDK</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Add Quasi-optimal Knots for the Piecewise Constant Basis — add_knots" />
<meta property="og:description" content="Given discretized functional data f defined over a grid, find the knots that are quasi-optimal for
the piecewise constant basis. It is 'quasi-optimal' since the optimality is locally verified at each
step when a knot is added to already existing ones. There is no guarantee that the final set of knots
is optimal globally over all possible knots of this size.

Utilizing 'add_split' function for evaluation of L new knots only in the intervals that contain
more than the specified (by M) number of knots. If it is not possible for the function to return the specified by L
number of additional knots a warning message is reported informing what is the maximal number of new knots
that can be added. The knots are added in such a way that it achieves the largest drop in the AMSE (which the sum
of mean squared errors accross all functional data.)" />
<meta property="og:image" content="https://ranibasna.github.io/ddk/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">DDK</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/DDk_vignette.html">DDk_vignette</a>
    </li>
    <li>
      <a href="../articles/DKK_and_Functional_analysis_on_wine_data.html">Reproducing analysis on wine data</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ranibasna/ddk/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Add Quasi-optimal Knots for the Piecewise Constant Basis</h1>
    <small class="dont-index">Source: <a href='https://github.com/ranibasna/ddk/blob/master/R/add_knots.R'><code>R/add_knots.R</code></a></small>
    <div class="hidden name"><code>add_knots.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Given discretized functional data <code>f</code> defined over a grid, find the knots that are quasi-optimal for
the piecewise constant basis. It is 'quasi-optimal' since the optimality is locally verified at each
step when a knot is added to already existing ones. There is no guarantee that the final set of knots
is optimal globally over all possible knots of this size.</p>

<p>Utilizing 'add_split' function for evaluation of L new knots only in the intervals that contain
more than the specified (by <code>M</code>) number of knots. If it is not possible for the function to return the specified by L
number of additional knots a warning message is reported informing what is the maximal number of new knots
that can be added. The knots are added in such a way that it achieves the largest drop in the AMSE (which the sum
of mean squared errors accross all functional data.)</p>
    </div>

    <pre class="usage"><span class='fu'>add_knots</span><span class='op'>(</span><span class='va'>f</span>, f_v <span class='op'>=</span> <span class='cn'>NULL</span>, <span class='va'>knots</span>, <span class='va'>L</span>, M <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>f</th>
      <td><p>functional data, i.e. matrix of the values row-wise evaluated over equidistant arguments (not given)</p></td>
    </tr>
    <tr>
      <th>f_v</th>
      <td><p>functional data i.e. matrix of the values row-wise evaluated over equidistant arguments as the validation data for which the validate the
decreas in the amse over the selected knots outputed from the functional data <code>f</code></p></td>
    </tr>
    <tr>
      <th>knots</th>
      <td><p>input knots, a sequence of ordered K integers in the range 0:nx, where nx=dim(f)[2]
in between knots intervals are defined open ended on the left hand side (knots[i]) and closed
on the right hand side (knots[i+1]): knots[i]+1,...,knots[i+1]</p></td>
    </tr>
    <tr>
      <th>L</th>
      <td><p>number of additional knots</p></td>
    </tr>
    <tr>
      <th>M</th>
      <td><p>the minimal number of points per intervals between knots for further split of the optimization to be performed.
The default is 5. It means that if there is less than M points per interval the further split of the interval
marked by knots is not performed. The program will stop if there is too few points to find the requested number
of knots with the given restriction for M.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A list of the following values</p>
<dt>nknots</dt><dd><p>sequence of K+L (old and new) knots</p></dd>
 <dt>NAMSE</dt><dd><p>the corresponding sequence of K+L-1 of the within knots
                 average mean square errors</p></dd>
 <dt>APPRERR</dt><dd><p>the decreasing sequence of the averaged squared L2 norms:
                ||f1 - hat f1l||_2^2+...+||fn - hat fnl||_2^2, l=0,...,L, where hat f_il are piecewise constant
                approximation of fi's with l knots added to the input knots.</p></dd>

    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    

<p>Nassar, H., Podgórski, K. Empirically driven orthonormal bases for functional data analysis.
<em>Proceedings of European Numerical Mathematics and Advanced Applications Conference 2019</em>.
Cognitive Systems, Department of Applied Mathematics and Computer Science, Technical University of Denmark, Denmark</p>
<p>Basna, R. Nassar, H., Podgórski, K. Machine Learning Assisted Orthonormal Bases Selection for Functional Data Analysis. (preprint)</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code>split</code>  for constructing split at a given knot; <code>opt_split</code>
for finding the optimal split within one interval; <code>add_splitw</code>
for selecting  the optimal split from a set of potential splits.</p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='va'>n</span><span class='op'>=</span><span class='fl'>10</span> <span class='co'>#number of samples</span>
<span class='co'>#f=rbetafda(n) #generating data</span>
<span class='co'>#f=rbetafda(n,ta=3,tb=3) #generating data</span>
<span class='va'>nx</span><span class='op'>=</span><span class='fl'>1000</span>
<span class='va'>f</span><span class='op'>=</span><span class='fu'><a href='rbetafda.html'>rbetafda</a></span><span class='op'>(</span><span class='va'>n</span>,<span class='va'>nx</span>,ta<span class='op'>=</span><span class='fl'>3</span>,tb<span class='op'>=</span><span class='fl'>3</span><span class='op'>)</span> <span class='co'>#generating data</span>

<span class='va'>nx</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/dim.html'>dim</a></span><span class='op'>(</span><span class='va'>f</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span> <span class='co'>#size of the equidistant one dimensional grid</span>
<span class='va'>hf</span><span class='op'>=</span><span class='fl'>1</span><span class='op'>/</span><span class='op'>(</span><span class='va'>nx</span><span class='op'>+</span><span class='fl'>1</span><span class='op'>)</span>  <span class='co'>#increment s i z e</span>
<span class='va'>grid</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span> <span class='op'>(</span><span class='va'>hf</span> , <span class='fl'>1</span><span class='op'>-</span><span class='va'>hf</span> , by<span class='op'>=</span><span class='va'>hf</span><span class='op'>)</span> , nrow<span class='op'>=</span><span class='fl'>1</span><span class='op'>)</span> <span class='co'>#grid</span>
<span class='va'>xx</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/vector.html'>vector</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='kw'>for</span><span class='op'>(</span> <span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='op'>(</span><span class='va'>nx</span><span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span>
  <span class='va'>Q</span><span class='op'>=</span><span class='fu'><a href='split.html'>split</a></span><span class='op'>(</span><span class='va'>f</span>,<span class='va'>i</span><span class='op'>)</span>
  <span class='va'>xx</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>=</span><span class='va'>Q</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>*</span><span class='va'>i</span><span class='op'>/</span><span class='va'>nx</span><span class='op'>+</span><span class='va'>Q</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>*</span><span class='op'>(</span><span class='va'>nx</span><span class='op'>-</span><span class='va'>i</span><span class='op'>)</span><span class='op'>/</span><span class='va'>nx</span>
<span class='op'>}</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>xx</span><span class='op'>)</span>
</div><div class='img'><img src='add_knots-1.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='va'>AMSE</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>nx</span><span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span><span class='op'>/</span><span class='va'>nx</span><span class='op'>*</span><span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span><span class='op'>(</span><span class='va'>f</span>,<span class='fl'>1</span>,<span class='va'>var</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>knots</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='va'>nx</span><span class='op'>)</span> <span class='co'>#We take zero as the location of the first knot since, we want intervals pointed</span>
<span class='co'># by 'knots' to be open-close, i.e. the k-th interval is 'knots[k]+1, knots[k+1]'</span>
<span class='va'>K</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>knots</span><span class='op'>)</span>

<span class='va'>KS</span><span class='op'>=</span><span class='fu'>add_knots</span><span class='op'>(</span><span class='va'>f</span>,knots<span class='op'>=</span><span class='va'>knots</span>,L<span class='op'>=</span><span class='fl'>10</span>, M <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span>
</div><div class='output co'>#&gt; proposed splits is 645 
#&gt; proposed splits is 292 865 
#&gt; [1] "printing the new knot"
#&gt; [1] 645
#&gt; proposed splits is 133 458 865 
#&gt; [1] "printing the new knot"
#&gt; [1] 292
#&gt; proposed splits is 133 458 761 967 
#&gt; [1] "printing the new knot"
#&gt; [1] 865
#&gt; proposed splits is 59 211 458 761 967 
#&gt; [1] "printing the new knot"
#&gt; [1] 133
#&gt; proposed splits is 59 211 373 555 761 967 
#&gt; [1] "printing the new knot"
#&gt; [1] 458
#&gt; proposed splits is 59 211 373 555 761 925 994 
#&gt; [1] "printing the new knot"
#&gt; [1] 967
#&gt; proposed splits is 59 211 373 555 706 814 925 994 
#&gt; [1] "printing the new knot"
#&gt; [1] 761
#&gt; proposed splits is 59 211 373 555 706 814 925 984 NA 
#&gt; [1] "printing the new knot"
#&gt; [1] 994
#&gt; proposed splits is 59 211 373 555 706 814 897 948 984 NA 
#&gt; [1] "printing the new knot"
#&gt; [1] 925
#&gt; proposed splits is 59 211 373 506 602 706 814 897 948 984 NA 
#&gt; [1] "printing the new knot"
#&gt; [1] 555</div><div class='input'><span class='va'>KS</span>
</div><div class='output co'>#&gt; $Fknots
#&gt;  [1]    0  133  292  458  555  645  761  865  925  967  994 1000
#&gt; 
#&gt; $FAMSE
#&gt;  [1] 0.017752663 0.013880798 0.012814407 0.003403344 0.003627512 0.011056448
#&gt;  [7] 0.012445392 0.006045039 0.008473167 0.023907391 0.104279808
#&gt; 
#&gt; $APPRERR
#&gt;  [1] 0.27794695 0.16970367 0.09762801 0.05974294 0.04799061 0.03666111
#&gt;  [7] 0.02599530 0.01828658 0.01567433 0.01369670 0.01191857
#&gt; </div><div class='input'>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>KS</span><span class='op'>$</span><span class='va'>APPRERR</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='img'><img src='add_knots-2.png' alt='' width='700' height='433' /></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Rani Basna, Hiba Nassar, Krzysztof Podgórski.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


