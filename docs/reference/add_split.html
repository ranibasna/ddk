<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>adding an optimal splitting point by choosing it from a set of potential splits. — add_split • DDK</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="adding an optimal splitting point by choosing it from a set of potential splits. — add_split" />
<meta property="og:description" content="for a given data f, and a set of intervals (that have end points given in 'LE' and 'RE'),
 left and right hand side endpoints,
all in the range [1:nx], this function finds the an additional split (knot) from the set of potential knots splits
 by minimizing the average mean square error of piecewise constant approximation to (rowwise) functional data given in f
that result from adding a new split. The intervals do not need to cover the entire range of f.
We use convention that for LE[k], the k-th interval is '(LE[k]+1):RE[k]'
which corresponds to open-closed intervals in the 'continuous' interpretation of the intervals (LE[k],RE[k]]
The minimization is over all k. The noimnated optimal splits within each interval are already given in the input and
the algorithm returns new optimal within interval splits that are increased by one and only modified in
the two intervals" />
<meta property="og:image" content="/logo.png" />






<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  

  

  </head>

  <body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">DDK</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/DDk_vignette.html">DDk_vignette</a>
    </li>
    <li>
      <a href="../articles/DKK and Functional analysis on wine data.html">Reproducing analysis on wine data</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ranibasna/ddk/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>adding an optimal splitting point by choosing it from a set of potential splits.</h1>
    <small class="dont-index">Source: <a href='https://github.com/ranibasna/ddk/blob/master/R/add_split.R'><code>R/add_split.R</code></a></small>
    <div class="hidden name"><code>add_split.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>for a given data <code>f</code>, and a set of intervals (that have end points given in 'LE' and 'RE'),
 left and right hand side endpoints,
all in the range [1:nx], this function finds the an additional split (knot) from the set of potential knots <code>splits</code>
 by minimizing the average mean square error of piecewise constant approximation to (rowwise) functional data given in f
that result from adding a new split. The intervals do not need to cover the entire range of f.
We use convention that for LE[k], the k-th interval is '(LE[k]+1):RE[k]'
which corresponds to open-closed intervals in the 'continuous' interpretation of the intervals (LE[k],RE[k]]
The minimization is over all k. The noimnated optimal splits within each interval are already given in the input and
the algorithm returns new optimal within interval splits that are increased by one and only modified in
the two intervals</p>
    </div>

    <div class="ref-usage sourceCode"><pre class='sourceCode r'><code><span class='fu'>add_split</span><span class='op'>(</span><span class='va'>f</span>, <span class='va'>LE</span>, <span class='va'>RE</span>, <span class='va'>AMSE</span>, <span class='va'>AMSE1</span>, <span class='va'>AMSE2</span>, <span class='va'>splits</span>, M <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span></code></pre></div>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>f</th>
      <td><p>n x nx matrix, where n is number of samples (rows) and nx reperesents the grid size in functional data interpreptation.</p></td>
    </tr>
    <tr>
      <th>LE</th>
      <td><p>vector of integers. indices for the left endpoints that are given as vectors of K integers in the range from 0 to nx-1,</p></td>
    </tr>
    <tr>
      <th>RE</th>
      <td><p>vector of integers. indices for the right endpoints that are given as vectors of K integers in the range from 1 to nx,</p></td>
    </tr>
    <tr>
      <th>AMSE</th>
      <td><p>vector of K values of the average mean square errors of the piecewise constant approximation based on given knots</p></td>
    </tr>
    <tr>
      <th>AMSE1</th>
      <td><p>vector of K values of the left-hand side (with respect to corresponding 'splits' below) values of the average mean square error</p></td>
    </tr>
    <tr>
      <th>AMSE2</th>
      <td><p>vector of K values of the righ-hand side (with respect to corresponding 'splits' below) values of the average mean square error</p></td>
    </tr>
    <tr>
      <th>splits</th>
      <td><p>vector of K values of the suggested splits (they are chosen optimally within given interval and
will be used to choose a new knot). The knot is chosen according to the criterium: the split leading to the largest gain accross all between knots intervals becomes a new knot.</p></td>
    </tr>
    <tr>
      <th>M</th>
      <td><p>the minimal number of points per intervals between knots for further split of the optimization to be performed.
The default is 5. It means that if there is less than M points per interval the further split of the interval
marked by knots is not performed. The program will stop if there is too few points to find the requested number
of knots with the given restriction for M.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>the list of the following:</p><ul>
<li><p>NLE and</p></li>
<li><p>NRE -- two vectors of all K+1 ordered indices within the range [1:nx]representing end points of new increased by one set of intervals obtained
by adding the optimal knot (the optimal split of one of the input intervals)</p></li>
<li><p>nsplits-a vector of K+1 values of the suggested splits (for using in the next iteration of this functiom to choose a new knot). These splits are optimal within intervals.</p></li>
<li><p>NAMSE-the K+1 vector of new the average mean square errors over the intervals obtained from the knots including the new one.</p></li>
<li><p>NAMSE1-the vector of K+1 values of the left-hand side (with respect to corresponding 'splits') values of the average mean square errors</p></li>
<li><p>NAMSE2-a vector of K+1 values of the right-hand side (with respect to corresponding 'splits') values of the average mean square errors</p></li>
<li><p>locsp-the location (left hand side) of the added new optimal split location,i.e. the split occurs in (LE[k]+1):RE[k], where k=locsp while LE and RE are the input values,
in the terms of output the new split is at NLE[k+1]=NRE[k]</p></li>
</ul>

    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Nassar, H., Podgórski, K. (2019) Empirically driven
  orthonormal bases for functional data analysis. <em>Preprint</em>. Department
  of Statistics, Lund University.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <div class="ref-examples sourceCode"><pre class='sourceCode r'><code><span class='r-in'><span class='co'>#START of example</span></span>
<span class='r-in'><span class='co'>#Generating data, needs 'rbetafda' function</span></span>
<span class='r-in'><span class='va'>n</span><span class='op'>=</span><span class='fl'>10</span></span>
<span class='r-in'><span class='va'>f</span><span class='op'>=</span><span class='fu'><a href='rbetafda.html'>rbetafda</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>nx</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/dim.html'>dim</a></span><span class='op'>(</span><span class='va'>f</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span> <span class='co'>#size of the equidistant one dimensional grid</span></span>
<span class='r-in'><span class='va'>hf</span><span class='op'>=</span><span class='fl'>1</span><span class='op'>/</span><span class='op'>(</span><span class='va'>nx</span><span class='op'>+</span><span class='fl'>1</span><span class='op'>)</span>  <span class='co'>#increment s i z e</span></span>
<span class='r-in'><span class='va'>grid</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span> <span class='op'>(</span><span class='va'>hf</span> , <span class='fl'>1</span><span class='op'>-</span><span class='va'>hf</span> , by<span class='op'>=</span><span class='va'>hf</span><span class='op'>)</span> , nrow<span class='op'>=</span><span class='fl'>1</span><span class='op'>)</span> <span class='co'>#grid</span></span>
<span class='r-in'><span class='va'>xx</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/vector.html'>vector</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span class='r-in'><span class='kw'>for</span><span class='op'>(</span> <span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>499</span><span class='op'>)</span><span class='op'>{</span></span>
<span class='r-in'> <span class='va'>Q</span><span class='op'>=</span><span class='fu'><a href='split.html'>split</a></span><span class='op'>(</span><span class='va'>f</span>,<span class='va'>i</span><span class='op'>)</span></span>
<span class='r-in'> <span class='va'>xx</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>=</span><span class='va'>Q</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>*</span><span class='va'>i</span><span class='op'>/</span><span class='va'>nx</span><span class='op'>+</span><span class='va'>Q</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>*</span><span class='op'>(</span><span class='va'>nx</span><span class='op'>-</span><span class='va'>i</span><span class='op'>)</span><span class='op'>/</span><span class='va'>nx</span></span>
<span class='r-in'> <span class='op'>}</span></span>
<span class='r-in'> <span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>xx</span><span class='op'>)</span></span>
<span class='r-plt'><img src='add_split-1.png' alt='' width='700' height='433' /></span>
<span class='r-in'> <span class='co'>#Preparation of the input values</span></span>
<span class='r-in'><span class='va'>AMSE</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>nx</span><span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span><span class='op'>/</span><span class='va'>nx</span><span class='op'>*</span><span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span><span class='op'>(</span><span class='va'>f</span>,<span class='fl'>1</span>,<span class='va'>var</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>knots</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='va'>nx</span><span class='op'>)</span> <span class='co'>#We take zero as the location of the first knot since, we want</span></span>
<span class='r-in'><span class='co'># intervals pointed by 'knots' to be open-close, i.e. the k-th interval is 'knots[k]+1, knots[k+1]'</span></span>
<span class='r-in'><span class='va'>K</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>knots</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>LE</span><span class='op'>=</span><span class='va'>knots</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='op'>(</span><span class='va'>K</span><span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span><span class='op'>]</span> <span class='co'>#The open ended left ends of the intervals (so add one to have the closed end)</span></span>
<span class='r-in'><span class='va'>RE</span><span class='op'>=</span><span class='va'>knots</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>:</span><span class='va'>K</span><span class='op'>]</span>     <span class='co'>#The close ended right ends of the intervals</span></span>
<span class='r-in'><span class='va'>splits</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/vector.html'>vector</a></span><span class='op'>(</span><span class='st'>'numeric'</span>,<span class='va'>K</span><span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span> <span class='co'>#The new interval-wise optimal split-points</span></span>
<span class='r-in'><span class='co'>#The left-hand side (with respect to corresponding 'splits') values of the average mean square error</span></span>
<span class='r-in'><span class='va'>AMSE1</span><span class='op'>=</span><span class='va'>splits</span></span>
<span class='r-in'><span class='co'># The right-hand side (with respect to corresponding 'splits')</span></span>
<span class='r-in'><span class='co'># values of the average mean square error</span></span>
<span class='r-in'><span class='va'>AMSE2</span><span class='op'>=</span><span class='va'>splits</span></span>
<span class='r-in'><span class='co'># First run through all the intervals is to compute all</span></span>
<span class='r-in'><span class='co'># interval-wise split and corresponding 'AMSE1' and 'AMSE2'</span></span>
<span class='r-in'><span class='kw'>for</span><span class='op'>(</span><span class='va'>k</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='op'>(</span><span class='va'>K</span><span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span> <span class='co'>#the loop running through all the intervals at the current knots values</span></span>
<span class='r-in'><span class='op'>{</span></span>
<span class='r-in'>  <span class='va'>ff</span><span class='op'>=</span><span class='va'>f</span><span class='op'>[</span>,<span class='op'>(</span><span class='va'>knots</span><span class='op'>[</span><span class='va'>k</span><span class='op'>]</span><span class='op'>+</span><span class='fl'>1</span><span class='op'>)</span><span class='op'>:</span><span class='op'>(</span><span class='va'>knots</span><span class='op'>[</span><span class='va'>k</span><span class='op'>+</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span><span class='op'>]</span></span>
<span class='r-in'>  <span class='va'>newsp</span><span class='op'>=</span><span class='fu'><a href='opt_split.html'>opt_split</a></span><span class='op'>(</span><span class='va'>ff</span>,<span class='va'>AMSE</span><span class='op'>[</span><span class='va'>k</span><span class='op'>]</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='va'>splits</span><span class='op'>[</span><span class='va'>k</span><span class='op'>]</span><span class='op'>=</span><span class='va'>knots</span><span class='op'>[</span><span class='va'>k</span><span class='op'>]</span><span class='op'>+</span><span class='va'>newsp</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span></span>
<span class='r-in'>  <span class='va'>AMSE1</span><span class='op'>[</span><span class='va'>k</span><span class='op'>]</span><span class='op'>=</span><span class='va'>newsp</span><span class='op'>[[</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>]</span></span>
<span class='r-in'>  <span class='va'>AMSE2</span><span class='op'>[</span><span class='va'>k</span><span class='op'>]</span><span class='op'>=</span><span class='va'>newsp</span><span class='op'>[[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>]</span></span>
<span class='r-in'> <span class='op'>}</span></span>
<span class='r-in'><span class='co'># computed splits (potential new knots) and corresponding AMSE1's and AMSE2's</span></span>
<span class='r-in'><span class='co'>####################</span></span>
<span class='r-in'><span class='va'>opt2</span><span class='op'>=</span><span class='fu'>add_split</span><span class='op'>(</span><span class='va'>f</span>,<span class='va'>LE</span>,<span class='va'>RE</span>,<span class='va'>AMSE</span>,<span class='va'>AMSE1</span>, <span class='va'>AMSE2</span>, <span class='va'>splits</span><span class='op'>)</span></span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> DMSE add_split 16.58068 </span>
<span class='r-in'> <span class='va'>L</span><span class='op'>=</span><span class='va'>opt2</span><span class='op'>$</span><span class='va'>NLE</span></span>
<span class='r-in'> <span class='va'>R</span><span class='op'>=</span><span class='va'>opt2</span><span class='op'>$</span><span class='va'>NRE</span></span>
<span class='r-in'> <span class='va'>AMS</span><span class='op'>=</span><span class='va'>opt2</span><span class='op'>$</span><span class='va'>NAMSE</span></span>
<span class='r-in'> <span class='va'>AMS1</span><span class='op'>=</span><span class='va'>opt2</span><span class='op'>$</span><span class='va'>NAMSE1</span></span>
<span class='r-in'> <span class='va'>AMS2</span><span class='op'>=</span><span class='va'>opt2</span><span class='op'>$</span><span class='va'>NAMSE2</span></span>
<span class='r-in'> <span class='va'>spl</span><span class='op'>=</span><span class='va'>opt2</span><span class='op'>$</span><span class='va'>nsplits</span></span>
<span class='r-in'> <span class='va'>opt2</span><span class='op'>=</span><span class='fu'>add_split</span><span class='op'>(</span><span class='va'>f</span>,<span class='va'>L</span>,<span class='va'>R</span>,<span class='va'>AMS</span>,<span class='va'>AMS1</span>,<span class='va'>AMS2</span>,<span class='va'>spl</span><span class='op'>)</span></span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> DMSE add_split 15.38328 3.272357 </span>
</code></pre></div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p><p>Developed by Rani Basna, Hiba Nassar, Krzysztof Podgórski.</p></p>
</div>

<div class="pkgdown">
  <p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 1.6.1.9001.</p></p>
</div>

      </footer>
   </div>

  


  

  </body>
</html>


