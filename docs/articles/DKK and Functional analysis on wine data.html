<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reproducing analysis on wine data â€¢ DDK</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Reproducing analysis on wine data">
<meta property="og:description" content="DDK">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">DDK</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/DDk_vignette.html">DDk_vignette</a>
    </li>
    <li>
      <a href="../articles/DKK%20and%20Functional%20analysis%20on%20wine%20data.html">Reproducing analysis on wine data</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ranibasna/ddk/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="DKK%20and%20Functional%20analysis%20on%20wine%20data_files/header-attrs-2.10/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Reproducing analysis on wine data</h1>
                        <h4 data-toc-skip class="author">Rani Basna</h4>
            
            <h4 data-toc-skip class="date">2021-09-14</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ranibasna/ddk/blob/master/vignettes/DKK%20and%20Functional%20analysis%20on%20wine%20data.Rmd" class="external-link"><code>vignettes/DKK and Functional analysis on wine data.Rmd</code></a></small>
      <div class="hidden name"><code>DKK and Functional analysis on wine data.Rmd</code></div>

    </div>

    
    
<p>This article attempts at reproducing the results presented at the paper Machine Learning Assisted Orthonormal Basis Selection for Functional Data Analysis.</p>
<div id="libraies" class="section level1">
<h1 class="hasAnchor">
<a href="#libraies" class="anchor" aria-hidden="true"></a>Libraies</h1>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("Splinets") for Orthogonal projections</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">Splinets</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ranibasna/ddk" class="external-link">DDK</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/reshape" class="external-link">reshape2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">RColorBrewer</span><span class="op">)</span></code></pre></div>
<p>We will first write few helper functions. These functions depends on few packages. Most importantly, the package Splinets. In order to get a full understanding of these objects and functions, one needs some understanding of the DDK methods presented in above mentioned paper as well as the practicle usage of the package Splinets presented at this <a href="https://arxiv.org/abs/2102.00733" class="external-link">arxiv paper</a></p>
</div>
<div id="helper-functions" class="section level1">
<h1 class="hasAnchor">
<a href="#helper-functions" class="anchor" aria-hidden="true"></a>Helper Functions</h1>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># function that helps in plotting the functional data</span>
<span class="va">df_plot_fda</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">S_data</span>, <span class="va">time_df</span>, <span class="va">s</span><span class="op">=</span><span class="fl">1</span>, <span class="va">a</span><span class="op">=</span> <span class="fl">0.8</span>, <span class="va">n_sample</span> <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">{</span>
  <span class="co"># to do</span>
  <span class="co"># check that the length of the time data agree with the dim of the data</span>
  <span class="co"># write an if statment that in case of empty time_df generate a one based on the dim S_data</span>
  <span class="va">df_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">S_data</span><span class="op">)</span><span class="op">)</span>
  <span class="co"># selecting samples</span>
  <span class="va">df_plot_n</span> <span class="op">&lt;-</span> <span class="va">df_plot</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="va">n_sample</span><span class="op">]</span>
  <span class="co"># add the time var</span>
  <span class="va">df_plot_n</span><span class="op">$</span><span class="va">time</span> <span class="op">&lt;-</span> <span class="va">time_df</span>
  <span class="va">df_plot_melt_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">df_plot_n</span>, id.vars<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"time"</span><span class="op">)</span><span class="op">)</span>
  <span class="co"># ploting</span>
  <span class="va">plot_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df_plot_melt_n</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, color<span class="op">=</span><span class="va">variable</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>size<span class="op">=</span><span class="va">s</span>, alpha<span class="op">=</span><span class="va">a</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span>, axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>  
  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">plot_n</span>, <span class="va">df_plot_melt_n</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span>
<span class="op">}</span>
<span class="co"># prepare the data</span>
<span class="va">data_prepare</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">f_data</span>, <span class="va">t_data</span><span class="op">)</span><span class="op">{</span>
        <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">f_data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
        <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">t_data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
        <span class="va">f_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">f_data</span><span class="op">)</span>
        <span class="va">ready_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">t_data</span>, <span class="va">f_data</span><span class="op">)</span>
        <span class="va">ready_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">ready_data</span><span class="op">)</span>
        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">ready_data</span><span class="op">)</span>
<span class="op">}</span>
<span class="co"># Prepare knots</span>
<span class="va">Knots_prepare</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">selected_knots</span>, <span class="va">Time</span><span class="op">)</span><span class="op">{</span>
        <span class="va">knots_normalized</span> <span class="op">&lt;-</span> <span class="va">selected_knots</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">selected_knots</span><span class="op">)</span>
        <span class="va">knots_normalized</span> <span class="op">=</span> <span class="va">knots_normalized</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">Time</span><span class="op">)</span><span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">Time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">Time</span><span class="op">)</span>
        <span class="co"># taking the first three decimal number</span>
        <span class="va">knots_normalized</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">knots_normalized</span>,<span class="fl">4</span><span class="op">)</span>, nsmall <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">knots_normalized</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">#</span>
<span class="va">GetProjCovEig</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">f_ready_data</span>, <span class="va">ready_knots</span><span class="op">)</span><span class="op">{</span>
  <span class="va">ProjObj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Splinets/man/project.html" class="external-link">project</a></span><span class="op">(</span><span class="va">f_ready_data</span>,<span class="va">ready_knots</span><span class="op">)</span>
  <span class="va">Sigma</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="va">ProjObj</span><span class="op">$</span><span class="va">coeff</span><span class="op">)</span>
  <span class="va">Spect</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/eigen.html" class="external-link">eigen</a></span><span class="op">(</span><span class="va">Sigma</span>,symmetric <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
  <span class="va">EigenSp</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/Splinets/man/lincomb.html" class="external-link">lincomb</a></span><span class="op">(</span><span class="va">ProjObj</span><span class="op">$</span><span class="va">basis</span>,<span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">Spect</span><span class="op">$</span><span class="va">vec</span><span class="op">)</span><span class="op">)</span>
  <span class="va">Proj_C_EV</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ProjObj <span class="op">=</span> <span class="va">ProjObj</span>, Sigma<span class="op">=</span><span class="va">Sigma</span>, Spect<span class="op">=</span><span class="va">Spect</span>, EigenSp<span class="op">=</span><span class="va">EigenSp</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">Proj_C_EV</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">#</span>
<span class="va">compare_fit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">N_plots</span>, <span class="va">SubsampleFractions</span>, <span class="va">ProjCovEigObj</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">is.vector</a></span><span class="op">(</span><span class="va">SubsampleFractions</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"SubsampleFractions has to be a vector of subsamples"</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">SubsampleFractions</span><span class="op">)</span> <span class="op">==</span> <span class="va">N_plots</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"length of SubsampleFractions has to be equal to the N_plots"</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="va">EgnFncts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">N_plots</span><span class="op">)</span><span class="op">{</span>
    <span class="va">EgnFncts</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Splinets/man/subsample.html" class="external-link">subsample</a></span><span class="op">(</span><span class="va">ProjCovEigObj</span><span class="op">$</span><span class="va">EigenSp</span>,<span class="fl">1</span><span class="op">:</span><span class="va">SubsampleFractions</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">EgnFncts</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">#</span>
<span class="va">get_Compare_Plot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">ready_f_data</span>, <span class="va">ProjCovEigObj</span>, <span class="va">portions</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">EgnFuncObj</span>, <span class="va">sampleNumber</span><span class="op">)</span><span class="op">{</span>
  <span class="va">C_mat</span><span class="op">=</span><span class="va">ProjCovEigObj</span><span class="op">$</span><span class="va">ProjObj</span><span class="op">$</span><span class="va">coeff</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">ProjCovEigObj</span><span class="op">$</span><span class="va">Spect</span><span class="op">$</span><span class="va">vec</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">ready_f_data</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,<span class="va">ready_f_data</span><span class="op">[</span>,<span class="va">sampleNumber</span><span class="op">]</span>,type<span class="op">=</span><span class="st">'l'</span>,lty<span class="op">=</span><span class="fl">1</span>,xlab<span class="op">=</span><span class="st">''</span>,ylab<span class="op">=</span><span class="st">''</span><span class="op">)</span>
            <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">ProjCovEigObj</span><span class="op">$</span><span class="va">ProjObj</span><span class="op">$</span><span class="va">sp</span>,sID<span class="op">=</span><span class="va">sampleNumber</span><span class="op">-</span><span class="fl">1</span>,col<span class="op">=</span><span class="st">'red'</span>,lty<span class="op">=</span><span class="fl">2</span>,lwd<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
            <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">portions</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
             <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Splinets/man/lincomb.html" class="external-link">lincomb</a></span><span class="op">(</span><span class="va">EgnFuncObj</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,<span class="va">C_mat</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">:</span><span class="va">portions</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,drop<span class="op">=</span><span class="cn">F</span><span class="op">]</span><span class="op">)</span>,col<span class="op">=</span><span class="st">'green'</span><span class="op">)</span>
             <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Splinets/man/lincomb.html" class="external-link">lincomb</a></span><span class="op">(</span><span class="va">EgnFuncObj</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,<span class="va">C_mat</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">:</span><span class="va">portions</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,drop<span class="op">=</span><span class="cn">F</span><span class="op">]</span><span class="op">)</span>,col<span class="op">=</span><span class="st">'brown'</span><span class="op">)</span>
             <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Splinets/man/lincomb.html" class="external-link">lincomb</a></span><span class="op">(</span><span class="va">EgnFuncObj</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>,<span class="va">C_mat</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">:</span><span class="va">portions</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,drop<span class="op">=</span><span class="cn">F</span><span class="op">]</span><span class="op">)</span>,col<span class="op">=</span><span class="st">'blue'</span>,lwd<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">}</span>
             <span class="op">}</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">#</span>
<span class="va">get_amse_diff</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">f_ready_data</span>, <span class="va">ProjCovEigObj</span>, <span class="va">t_data</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">is.data.frame</a></span><span class="op">(</span><span class="va">t_data</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">f_hat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Splinets/man/evspline.html" class="external-link">evspline</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">ProjCovEigObj</span><span class="op">$</span><span class="va">ProjObj</span><span class="op">$</span><span class="va">sp</span>, x <span class="op">=</span> <span class="va">t_data</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">is.vector</a></span><span class="op">(</span><span class="va">t_data</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">f_hat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Splinets/man/evspline.html" class="external-link">evspline</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">ProjCovEigObj</span><span class="op">$</span><span class="va">ProjObj</span><span class="op">$</span><span class="va">sp</span>, x <span class="op">=</span> <span class="va">t_data</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="va">f_diff</span> <span class="op">&lt;-</span> <span class="va">f_hat</span> <span class="op">-</span> <span class="va">f_ready_data</span>
  <span class="va">AMSE_diff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">f_ready_data</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="fu"><a href="../reference/amse.html">amse</a></span><span class="op">(</span><span class="va">f_diff</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
  <span class="co"># AMSE_diff &lt;- amse(f_diff[,-1])</span>
  <span class="va">AMSE_diff_list</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">f_hat</span>, <span class="va">f_diff</span>, <span class="va">AMSE_diff</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">AMSE_diff_list</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">#</span>
<span class="va">plot_EigenfunctionEigenValueScaled</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">ProjCovEigObj</span>, <span class="va">EigenNumber</span>, <span class="va">mrgn</span><span class="op">=</span><span class="fl">2</span>, <span class="va">type</span><span class="op">=</span><span class="st">'l'</span>, <span class="va">bty</span><span class="op">=</span><span class="st">"n"</span>,<span class="va">col</span><span class="op">=</span><span class="st">'deepskyblue4'</span>,
                       <span class="va">lty</span><span class="op">=</span><span class="fl">1</span>, <span class="va">lwd</span><span class="op">=</span><span class="fl">2</span>, <span class="va">xlim</span><span class="op">=</span><span class="cn">NULL</span>, <span class="va">ylim</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">xlab</span><span class="op">=</span><span class="st">""</span>, <span class="va">ylab</span> <span class="op">=</span> <span class="st">""</span>, <span class="va">vknots</span><span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">EigenNumber</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">" please insert the number of eigenfunctions as EigenMuber"</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="va">y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Splinets/man/evspline.html" class="external-link">evspline</a></span><span class="op">(</span><span class="va">ProjCovEigObj</span><span class="op">$</span><span class="va">EigenSp</span>, sID <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">EigenNumber</span><span class="op">)</span>
  <span class="va">Arg</span><span class="op">=</span><span class="va">y</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>
  <span class="va">Val</span><span class="op">=</span><span class="va">y</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span>,drop<span class="op">=</span><span class="cn">F</span><span class="op">]</span>
  <span class="co"># if(is.null(xlim)){</span>
  <span class="co">#   xlim = range(Arg)</span>
  <span class="co"># }</span>
  <span class="co"># if(is.null(ylim)){</span>
  <span class="co">#   ylim = range(Val)</span>
  <span class="co"># }</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Arg</span>,<span class="va">Val</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">ProjCovEigObj</span><span class="op">$</span><span class="va">Spect</span><span class="op">$</span><span class="va">values</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,type<span class="op">=</span><span class="va">type</span>,bty<span class="op">=</span><span class="va">bty</span>,col<span class="op">=</span><span class="va">col</span>,xlim<span class="op">=</span><span class="va">xlim</span>,ylim<span class="op">=</span><span class="va">ylim</span>,
       xlab<span class="op">=</span><span class="va">xlab</span>,ylab<span class="op">=</span><span class="va">ylab</span>,lty<span class="op">=</span><span class="va">lty</span>,lwd<span class="op">=</span><span class="va">lwd</span><span class="op">)</span>
  <span class="va">ourcol</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="st">'darkorange3'</span>, <span class="st">'goldenrod'</span>, <span class="st">'darkorchid4'</span>,
              <span class="st">'darkolivegreen4'</span>, <span class="st">'deepskyblue'</span>, <span class="st">'red4'</span>,
              <span class="st">'slateblue'</span>,<span class="st">'deepskyblue4'</span><span class="op">)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">EigenNumber</span><span class="op">)</span><span class="op">{</span>
      <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">Arg</span>,<span class="va">Val</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">ProjCovEigObj</span><span class="op">$</span><span class="va">Spect</span><span class="op">$</span><span class="va">values</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>,col<span class="op">=</span><span class="va">ourcol</span><span class="op">[</span><span class="op">(</span><span class="va">i</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span><span class="fl">8</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span>,lty<span class="op">=</span><span class="va">lty</span>,lwd<span class="op">=</span><span class="va">lwd</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">vknots</span><span class="op">)</span><span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">ProjCovEigObj</span><span class="op">$</span><span class="va">EigenSp</span><span class="op">@</span><span class="va">knots</span>, lty <span class="op">=</span> <span class="fl">3</span>, lwd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">0</span>, lwd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="wine-data" class="section level1">
<h1 class="hasAnchor">
<a href="#wine-data" class="anchor" aria-hidden="true"></a>wine data</h1>
<p>For more details on the wine data, see the description part of the data in the DDK paper.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># get the data from the DKK pacakge</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"Wine"</span><span class="op">)</span>
<span class="va">f_data_wine</span> <span class="op">&lt;-</span> <span class="va">Wine</span><span class="op">$</span><span class="va">x.learning</span>
<span class="va">t_df_wine</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">f_data_wine</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>
<span class="co"># test data</span>
<span class="va">f_data_wine_test</span> <span class="op">&lt;-</span> <span class="va">Wine</span><span class="op">$</span><span class="va">x.test</span>
<span class="va">t_df_wine_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">f_data_wine_test</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>
<span class="co"># remove raw 84 since it is an outlier</span>
<span class="va">f_data_wine</span> <span class="op">&lt;-</span> <span class="va">f_data_wine</span><span class="op">[</span><span class="op">-</span><span class="fl">84</span>,<span class="op">]</span>
<span class="co"># ploting</span>
<span class="va">wine_plot</span> <span class="op">&lt;-</span> <span class="fu">df_plot_fda</span><span class="op">(</span>S_data <span class="op">=</span> <span class="va">f_data_wine</span>, time_df <span class="op">=</span> <span class="va">t_df_wine</span>, a <span class="op">=</span> <span class="fl">1</span>, s <span class="op">=</span> <span class="fl">0.5</span>, n_sample <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="va">wine_plot</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"PuOr"</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"None"</span><span class="op">)</span>
<span class="va">p</span></code></pre></div>
<p><img src="DKK%20and%20Functional%20analysis%20on%20wine%20data_files/figure-html/unnamed-chunk-2-1.png" width="576"></p>
<p>Next, we run the DKK algorithm using the add_knots function. We need to input the training data, the test data, the search for the knots interval as well as the requested number of knots.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># knot selection</span>
<span class="va">initial_knots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">f_data_wine</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>
<span class="va">initial_knots</span>
<span class="co">#&gt; [1]   0 256</span>
<span class="co"># selecting the knots with add_knots function</span>
<span class="va">KS_wine</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_knots.html">add_knots</a></span><span class="op">(</span>f <span class="op">=</span> <span class="va">f_data_wine</span>, f_v <span class="op">=</span> <span class="va">f_data_wine_test</span>, knots <span class="op">=</span> <span class="va">initial_knots</span>, L <span class="op">=</span> <span class="fl">8</span>, M <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="co">#&gt; proposed splits is 139 </span>
<span class="co">#&gt; nx is 256 </span>
<span class="co">#&gt; DMSE add_split 0.69454 </span>
<span class="co">#&gt; proposed splits is 40 193 </span>
<span class="co">#&gt; [1] "printing the new knot"</span>
<span class="co">#&gt; [1] 139</span>
<span class="co">#&gt; AMSE_v is 0.00640309 0.003127215 </span>
<span class="co">#&gt; len_v is 139 117 256 </span>
<span class="co">#&gt; current TMSE is 0.004905913 </span>
<span class="co">#&gt; DMSE add_split 0.1089644 0.1797647 </span>
<span class="co">#&gt; proposed splits is 40 167 199 </span>
<span class="co">#&gt; [1] "printing the new knot"</span>
<span class="co">#&gt; [1] 193</span>
<span class="co">#&gt; AMSE_v is 0.00640309 0.003852713 8.21172e-05 </span>
<span class="co">#&gt; len_v is 139 54 63 256 </span>
<span class="co">#&gt; current TMSE is 0.004905913 0.004309568 </span>
<span class="co">#&gt; DMSE add_split 0.1089644 0.1389693 0.002181619 </span>
<span class="co">#&gt; proposed splits is 40 154 186 199 </span>
<span class="co">#&gt; [1] "printing the new knot"</span>
<span class="co">#&gt; [1] 167</span>
<span class="co">#&gt; AMSE_v is 0.00640309 0.0004499355 0.002316235 8.21172e-05 </span>
<span class="co">#&gt; len_v is 139 28 26 63 256 </span>
<span class="co">#&gt; current TMSE is 0.004905913 0.004309568 0.00378134 </span>
<span class="co">#&gt; DMSE add_split 0.1089644 0.009674541 0.0352665 0.002181619 </span>
<span class="co">#&gt; proposed splits is 21 83 154 186 199 </span>
<span class="co">#&gt; [1] "printing the new knot"</span>
<span class="co">#&gt; [1] 40</span>
<span class="co">#&gt; AMSE_v is 0.0180058 0.0006940853 0.0004499355 0.002316235 8.21172e-05 </span>
<span class="co">#&gt; len_v is 40 99 28 26 63 256 </span>
<span class="co">#&gt; current TMSE is 0.004905913 0.004309568 0.00378134 0.003386486 </span>
<span class="co">#&gt; DMSE add_split 0.4688823 0.03380327 0.009674541 0.0352665 0.002181619 </span>
<span class="co">#&gt; proposed splits is 15 28 83 154 186 199 </span>
<span class="co">#&gt; [1] "printing the new knot"</span>
<span class="co">#&gt; [1] 21</span>
<span class="co">#&gt; AMSE_v is 0.0009594829 0.01381429 0.0006940853 0.0004499355 0.002316235 8.21172e-05 </span>
<span class="co">#&gt; len_v is 21 19 99 28 26 63 256 </span>
<span class="co">#&gt; current TMSE is 0.004905913 0.004309568 0.00378134 0.003386486 0.001677066 </span>
<span class="co">#&gt; DMSE add_split 0.01392552 0.1525922 0.03380327 0.009674541 0.0352665 0.002181619 </span>
<span class="co">#&gt; proposed splits is 15 NA 34 83 154 186 199 </span>
<span class="co">#&gt; [1] "printing the new knot"</span>
<span class="co">#&gt; [1] 28</span>
<span class="co">#&gt; AMSE_v is 0.0009594829 0.02186483 0.002538623 0.0006940853 0.0004499355 0.002316235 8.21172e-05 </span>
<span class="co">#&gt; len_v is 21 7 12 99 28 26 63 256 </span>
<span class="co">#&gt; current TMSE is 0.004905913 0.004309568 0.00378134 0.003386486 0.001677066 0.001368651 </span>
<span class="co">#&gt; DMSE add_split 0.01392552 NA 0.0008778009 0.03380327 0.009674541 0.0352665 0.002181619 </span>
<span class="co">#&gt; proposed splits is 15 NA 34 83 154 173 NA 199 </span>
<span class="co">#&gt; [1] "printing the new knot"</span>
<span class="co">#&gt; [1] 186</span>
<span class="co">#&gt; AMSE_v is 0.0009594829 0.02186483 0.002538623 0.0006940853 0.0004499355 0.001566586 0.0006183465 8.21172e-05 </span>
<span class="co">#&gt; len_v is 21 7 12 99 28 19 7 63 256 </span>
<span class="co">#&gt; current TMSE is 0.004905913 0.004309568 0.00378134 0.003386486 0.001677066 0.001368651 0.001266586 </span>
<span class="co">#&gt; DMSE add_split 0.01392552 NA 0.0008778009 0.03380327 0.009674541 0.01432022 NA 0.002181619 </span>
<span class="co">#&gt; proposed splits is 15 NA 34 48 133 154 173 NA 199 </span>
<span class="co">#&gt; [1] "printing the new knot"</span>
<span class="co">#&gt; [1] 83</span>
<span class="co">#&gt; AMSE_v is 0.0009594829 0.02186483 0.002538623 0.0003723263 0.0004551788 0.0004499355 0.001566586 0.0006183465 8.21172e-05 </span>
<span class="co">#&gt; len_v is 21 7 12 43 56 28 19 7 63 256 </span>
<span class="co">#&gt; current TMSE is 0.004905913 0.004309568 0.00378134 0.003386486 0.001677066 0.001368651 0.001266586 0.00116028</span>
<span class="va">KS_wine</span><span class="op">$</span><span class="va">Fknots</span>
<span class="co">#&gt;  [1]   0  21  28  40  83 139 167 186 193 256</span></code></pre></div>
<p>Next, we plot the reduction in AMSE in the Functional Wine data.(Orange-bottom) reduction in AMSE achieved after each additional knot selection during training.(Blue-top) reduction achieved after each additional knot selection on the validation data.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># ploting the reduction of the AMSE </span>
<span class="co"># For train data</span>
<span class="va">df_knots_wine</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"x"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">KS_wine</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, <span class="st">"Error_reduction"</span> <span class="op">=</span> <span class="va">KS_wine</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="co"># For test data</span>
<span class="va">df_knots_wine_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"x"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">KS_wine</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, <span class="st">"Error_reduction"</span> <span class="op">=</span> <span class="va">KS_wine</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="co"># ploting amse reduction</span>
<span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span>  <span class="va">df_knots_wine_test</span><span class="op">$</span><span class="va">x</span>,y <span class="op">=</span>  <span class="va">df_knots_wine_test</span><span class="op">$</span><span class="va">Error_reduction</span>,type<span class="op">=</span><span class="st">'p'</span>,pch<span class="op">=</span><span class="fl">16</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">15</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.01</span><span class="op">)</span>,ylab<span class="op">=</span><span class="st">'Average Mean Square Error'</span>,xlab<span class="op">=</span><span class="st">'Iterations'</span>, bty<span class="op">=</span><span class="st">"n"</span>, col<span class="op">=</span><span class="st">"deepskyblue4"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span>  <span class="va">df_knots_wine</span><span class="op">$</span><span class="va">x</span>,y<span class="op">=</span> <span class="va">df_knots_wine</span><span class="op">$</span><span class="va">Error_reduction</span>,type<span class="op">=</span><span class="st">'p'</span>, pch<span class="op">=</span><span class="fl">16</span>, col<span class="op">=</span><span class="st">'darkorange3'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Training data"</span>, <span class="st">"Validation data"</span><span class="op">)</span>,
  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"darkorange3"</span>, <span class="st">"deepskyblue4"</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">3</span>, cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p><img src="DKK%20and%20Functional%20analysis%20on%20wine%20data_files/figure-html/plotingWineData-1.png" width="576"></p>
<p>Let us plot the data with the selected knots to visualize how the DDK algorithm chooses the knots locations. This figure displays the outcome of the validation process and the selected knots from the training and validations represented in dashed lines.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># ploting</span>
<span class="va">plot_dist_knots_wine</span> <span class="op">&lt;-</span> <span class="fu">df_plot_fda</span><span class="op">(</span>S_data <span class="op">=</span> <span class="va">f_data_wine</span>, time_df <span class="op">=</span> <span class="va">t_df_wine</span><span class="op">)</span>
<span class="va">plot_dist_knots_wine</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">KS_wine</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, linetype<span class="op">=</span><span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"PuOr"</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"None"</span><span class="op">)</span></code></pre></div>
<p><img src="DKK%20and%20Functional%20analysis%20on%20wine%20data_files/figure-html/PlotingKnots-1.png" width="576"></p>
</div>
<div id="comparing-equidistance-to-the-knote-selection-method" class="section level1">
<h1 class="hasAnchor">
<a href="#comparing-equidistance-to-the-knote-selection-method" class="anchor" aria-hidden="true"></a>Comparing equidistance to the knote selection method</h1>
<p>We first start by defining some needed objects. For more details on these objects see the package Splinets</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Wine_DDKnots</span> <span class="op">&lt;-</span> <span class="fu">Knots_prepare</span><span class="op">(</span>selected_knots <span class="op">=</span> <span class="va">KS_wine</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, Time <span class="op">=</span> <span class="va">t_df_wine</span><span class="op">)</span>
<span class="va">n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Wine_DDKnots</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span></code></pre></div>
<div id="equidistance-knots-case" class="section level2">
<h2 class="hasAnchor">
<a href="#equidistance-knots-case" class="anchor" aria-hidden="true"></a>equidistance knots case</h2>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># prepare the data</span>
<span class="va">Wine_prepared</span> <span class="op">&lt;-</span> <span class="fu">data_prepare</span><span class="op">(</span>f_data <span class="op">=</span> <span class="va">f_data_wine</span>, t_data <span class="op">=</span> <span class="va">t_df_wine</span><span class="op">)</span>
<span class="va">Wine_equi_knots</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">t_df_wine</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">t_df_wine</span><span class="op">)</span>, by<span class="op">=</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">t_df_wine</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">t_df_wine</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="va">n</span> <span class="op">)</span>
<span class="va">WineObj_eqi</span> <span class="op">&lt;-</span> <span class="fu">GetProjCovEig</span><span class="op">(</span>f_ready_data <span class="op">=</span> <span class="va">Wine_prepared</span>, ready_knots <span class="op">=</span> <span class="va">Wine_equi_knots</span><span class="op">)</span></code></pre></div>
</div>
<div id="knot_selection-dkk-case" class="section level2">
<h2 class="hasAnchor">
<a href="#knot_selection-dkk-case" class="anchor" aria-hidden="true"></a>Knot_selection DKK case</h2>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Wine_DDKnots</span> <span class="op">&lt;-</span> <span class="fu">Knots_prepare</span><span class="op">(</span>selected_knots <span class="op">=</span> <span class="va">KS_wine</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, Time <span class="op">=</span> <span class="va">t_df_wine</span><span class="op">)</span>
<span class="va">WineObj</span> <span class="op">&lt;-</span> <span class="fu">GetProjCovEig</span><span class="op">(</span>f_ready_data <span class="op">=</span> <span class="va">Wine_prepared</span>, ready_knots <span class="op">=</span> <span class="va">Wine_DDKnots</span><span class="op">)</span></code></pre></div>
<p>We first plot the eigenvalues ordered in a decreasing manner</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">WineObj</span><span class="op">$</span><span class="va">Spect</span><span class="op">$</span><span class="va">values</span>, type <span class="op">=</span><span class="st">'p'</span>,col<span class="op">=</span><span class="st">'darkorange3'</span>, lwd<span class="op">=</span><span class="fl">4</span>, ylab<span class="op">=</span><span class="st">""</span>, xlab<span class="op">=</span><span class="st">""</span>, bty<span class="op">=</span><span class="st">"n"</span><span class="op">)</span></code></pre></div>
<p><img src="DKK%20and%20Functional%20analysis%20on%20wine%20data_files/figure-html/eigenvaluesPlot-1.png" width="576"></p>
<p>Next, we plot the first three eigen functions scaled by the square roots of their corresponding eigenvalues.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">plot_EigenfunctionEigenValueScaled</span><span class="op">(</span>ProjCovEigObj <span class="op">=</span> <span class="va">WineObj</span>, EigenNumber <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>    </code></pre></div>
<p><img src="DKK%20and%20Functional%20analysis%20on%20wine%20data_files/figure-html/EigenfunctionEigenValueScaledPlot-1.png" width="576"></p>
<p>Next figure, One sample data (Blue curve), the projected data into splinets build over the knots chosen with DDK(yellow curve) with the location of the selected knots (vertical dashed lines), and the data decomposed using only the first eigenfunctions(orange curve);</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">C_mat_Wine</span><span class="op">=</span><span class="va">WineObj</span><span class="op">$</span><span class="va">ProjObj</span><span class="op">$</span><span class="va">coeff</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">WineObj</span><span class="op">$</span><span class="va">Spect</span><span class="op">$</span><span class="va">vec</span>
<span class="va">EgenFunWine1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Splinets/man/subsample.html" class="external-link">subsample</a></span><span class="op">(</span><span class="va">WineObj</span><span class="op">$</span><span class="va">EigenSp</span>, <span class="fl">1</span><span class="op">)</span>
<span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">Wine_prepared</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,<span class="va">Wine_prepared</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,type<span class="op">=</span><span class="st">'l'</span>,lty<span class="op">=</span><span class="fl">1</span>,xlab<span class="op">=</span><span class="st">''</span>,ylab<span class="op">=</span><span class="st">''</span>, bty<span class="op">=</span><span class="st">"n"</span>, 
         col<span class="op">=</span><span class="st">"deepskyblue4"</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.5</span>,<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">f_data_wine</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
             <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">WineObj</span><span class="op">$</span><span class="va">ProjObj</span><span class="op">$</span><span class="va">sp</span>,sID<span class="op">=</span><span class="fl">2</span><span class="op">-</span><span class="fl">1</span>,col<span class="op">=</span><span class="st">'goldenrod'</span>,lty<span class="op">=</span><span class="fl">1</span>,lwd<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
             <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Splinets/man/lincomb.html" class="external-link">lincomb</a></span><span class="op">(</span><span class="va">EgenFunWine1</span>,<span class="va">C_mat_Wine</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span>,drop<span class="op">=</span><span class="cn">F</span><span class="op">]</span><span class="op">)</span>,col<span class="op">=</span><span class="st">'darkorange3'</span><span class="op">)</span>
             <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">WineObj</span><span class="op">$</span><span class="va">EigenSp</span><span class="op">@</span><span class="va">knots</span>, lty <span class="op">=</span> <span class="fl">3</span>, lwd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">}</span></code></pre></div>
<p><img src="DKK%20and%20Functional%20analysis%20on%20wine%20data_files/figure-html/unnamed-chunk-6-1.png" width="576"></p>
<p>Finally, One sample data (Blue curve), the projected data into splinets build over equally spaced knots (yellow curve)with the location of the knots (vertical dashed lines).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">Wine_prepared</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,<span class="va">Wine_prepared</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,type<span class="op">=</span><span class="st">'l'</span>,lty<span class="op">=</span><span class="fl">1</span>,xlab<span class="op">=</span><span class="st">''</span>,ylab<span class="op">=</span><span class="st">''</span>, bty<span class="op">=</span><span class="st">"n"</span>,
         col<span class="op">=</span><span class="st">"deepskyblue4"</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.5</span>,<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">f_data_wine</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
             <span class="co"># the equi distance</span>
             <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">WineObj_eqi</span><span class="op">$</span><span class="va">ProjObj</span><span class="op">$</span><span class="va">sp</span>, sID<span class="op">=</span><span class="fl">2</span><span class="op">-</span><span class="fl">1</span>, col<span class="op">=</span><span class="st">'red'</span>, lty<span class="op">=</span><span class="fl">1</span>,lwd<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
             <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">WineObj_eqi</span><span class="op">$</span><span class="va">EigenSp</span><span class="op">@</span><span class="va">knots</span>, lty <span class="op">=</span> <span class="fl">3</span>, lwd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">}</span></code></pre></div>
<p><img src="DKK%20and%20Functional%20analysis%20on%20wine%20data_files/figure-html/unnamed-chunk-7-1.png" width="576"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Rani Basna, Hiba Nassar, Krzysztof PodgÃ³rski.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link external-link">pkgdown</a> 1.6.1.9001.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
